# Παράρτημα Ζ - Πώς Φτιάχνεται η Rust και η «νυχτερινή Rust»

Το παρόν παράρτημα αφορά το πώς φτιάχνεται η Rust και το πώς αυτό επηρεάζει
εσάς ως προγραμματιστή.

### Σταθερότητα Χωρίς Στασιμότητα

Ως γλώσσα, η Rust νοιάζεται *πολύ* για τη σταθερότητα του κώδικά σας. Θέλουμε
η Rust να είναι ένα θεμέλιο στερεό σα βράχος στον οποίο μπορείτε να χτίσετε,
και αν τα πράγματα άλλαζαν συνέχεια, αυτό θα ήταν αδύνατο. Την ίδια στιγμή,
αν δε μπορούμε να πειραματιστούμε με νέες δυνατότητες, ίσως δε μπορέσουμε να
εντοπίσουμε σημαντικά ελαττώματα τους παρά μόνο μετά την κυκλοφορία τους,
όταν πλέον δε θα μπορούμε να τα διορθώσουμε.

Η λύση μας σε αυτό το πρόβλημά είναι αυτό που αποκαλούμε «σταθερότητα χωρίς
στασιμότητα» και η αρχή που μας καθοδηγεί είναι η εξής: δε θα πρέπει ποτέ να
φοβάστε να αναβαθμίσετε σε μια νέα σταθερή έκδοση της Rust. Κάθε αναβάθμιση
θα πρέπει να είναι ανώδυνη, αλλά θα πρέπει να σας φέρνει και καινούριες
δυνατότητες, λιγότερα λάθη, και μικρότερους χρόνους μεταγλώττισης.

### Τσαφ, Τσουφ! Κανάλια Κυκλοφορίας και Παίρνοντας τα Τρένα

Η ανάπτυξη της Rust ακολουθεί κάτι που λέγεται *«πρόγραμμα τρένου»*. Αυτό
σημαίνει ότι όλη η ανάπτυξη γίνεται στον κλάδο `master` του αποθετηρίου της
Rust. Οι κυκλοφορίες ακολουθούν το μοντέλο που χρησιμοποιήθηκε από το
Cisco IOS και άλλα projects λογισμικού. Υπάρχουν τρία *κανάλια κυκλοφορίας*
για τη Rust:

* Νυχτερινό (nightly)
* Δοκιμαστικό (beta)
* Στθερό (stable)

Οι περισσότεροι χρήστες της Rust χρησιμοποιούν κυρίως το σταθερό κανάλι, αλλά
όσοι θέλουν να δοκιμάσουν πειραματικές νέες δυνατότητες μπορούν να
χρησιμοποιήσουν το νυχτερινό ή το δοκιμαστικό κανάλι.

Ακολουθεί ένα παράδειγμα του πώς λειτουργεί η διαδικασία ανάπτυξης και
κυκλοφορίας: ας υποθέσουμε ότι η ομάδα της Rust εργάζεται πάνω στην κυκλοφορία
της Rust 1.5. Στην πραγματικότητα, η εν λόγω έκδοση κυκλοφόρησε το Δεκέμβριο
του 2015, αλλά θα μας δώσει ρεαλιστικούς αριθμούς έκδοσης για το παράδειγμά μας.
Μία νέα δυνατότητα προστίθεται στη Rust: μία νέα παράδοση φτάνει στον κλάδο
`master`. Κάθε βράδυ, μια νυχτερινή έκδοση της Rust παράγεται. Κάθε μέρα είναι
μέρα κυκλοφορίας, και οι κυκλοφορίες δημιουργούνται αυτόματα από τις υποδομές
μας. Έτσι, καθώς περνάει ο καιρός, οι κυκλοφορίες μας μοιάζουν κάπως έτσι, μία
κάθε βράδυ:

```text
nightly: * - - * - - *
```

Κάθε έξι εβδομάδες, είναι ώρα να ετοιμάσουμε μια καινούρια κυκλοφορία! Ο κλάδος
`beta` του αποθετηρίου της Rust διακλαδίζεται από τον κλάδο `master` ο οποίος
χρησιμοποιείται από το νυχτερινό κανάλι. Τώρα, υπάρχουν δύο κυκλοφορίες:

```text
nightly: * - - * - - *
                     |
beta:                *
```

Οι περισσότεροι χρήστες δε χρησιμοποιούν ενεργά τις δοκιμαστικές κυκλοφορίες,
αλλά δοκιμάζουν να μεταγλωττίζουν τα projects τους χρησιμοποιώντας αυτό το
κανάλι στα συστήματα συνεχούς ενσωμάτωσης, ώστε να βοηθήσουν τη Rust να
ανακαλύψει τυχόν οπισθοδρομίσεις. Στο μεταξύ, συνεχίζει να υπάρχει μια
νυχτερινή κυκλοφορία κάθε βράδυ:

```text
nightly: * - - * - - * - - * - - *
                     |
beta:                *
```

Ας υποθέσουμε ότι εντοπίζεται μια οπισθοδρόμιση. Ευτυχώς που είχαμε καιρό να
ελέγξουμε τη δοκιμαστική κυκλοφορία προτού η οπισθοδρόμιση να τρυπώσει στη
σταθερή κυκλοφορία! Η διόρθωση εφαρμόζεται στο `master` έτσι ώστε η νυχτερινή
έκδοση να διορθωθεί, και ύστερα η διόρθωση εφαρμόζεται ξανά στον κλάδο `beta`,
και μια νέα κυκλοφορία του καναλιού `beta` παράγεται:

```text
nightly: * - - * - - * - - * - - * - - *
                     |
beta:                * - - - - - - - - *
```

Έξι εβδομάδες μετά την πρώτη δοκιμαστική κυκλοφορία, είναι ώρα για μια σταθερή
κυκλοφορία! Ο κλάδος `stable` δημιουργείται από τον κλάδο `beta`:

```text
nightly: * - - * - - * - - * - - * - - * - * - *
                     |
beta:                * - - - - - - - - *
                                       |
stable:                                *
```

Γιούχου! Η Rust 1.5 είναι γεγονός! Όμως ξεχάσαμε κάτι: επειδή παρήλθαν οι έξι
εβδομάδες, χρειαζόμαστε και μια νέα δοκιμαστική έκδοση της *επόμενης* έκδοσης
της Rust, 1.6. Έτσι, αφότου το `stable` δημιουργηθεί από το `beta`, η επόμενη
έκδοση του `beta` διακλαδώνεται ξανά από το `nightly`.

```text
nightly: * - - * - - * - - * - - * - - * - * - *
                     |                         |
beta:                * - - - - - - - - *       *
                                       |
stable:                                *
```

Αυτό ονομάζεται «μοντέλο τρένου» γιατί κάθε έξι εβδομάδες, μια κυκλοφορία
«φεύγει από το σταθμό», αλλά πρέπει να κάνει το ταξίδι μέσα από το δοκιμαστικό
κανάλι πριν φτάσει στον προορισμό της ως σταθερή κυκλοφορία.

Η Rust έχει κυκλοφορίες κάθε έξι εβδομάδες, σα ρολόι. Αν ξέρετε την ημερμοηνία
μίας κυκλοφορίας της Rust, ξέρετε την ημερομηνια της επόμενης: είναι έξι
εβδομάδες αργότερα. Μία ωραία πτυχή του να είναι οι κυκλοφορίες προγραμματισμένες
για κάθε έξι εβδομάδες είναι ότι το επόμενο τρένο έρχεται πάντα σύντομα. Αν μια
δυνατότητα δεν προλάβει να επιβιβαστεί σε μια συγκεκριμένη κυκλοφορία, δεν υπάρχει
λόγος ανησυχίας: σύντομα θα έρθει μια νέα κυκλοφορία! Αυτό βοηθάει να μειώνεται
τυχόν πίεση να τρυπώσουν μη τελειοποιηένες δυνατότητες στην κυκλοφορία λόγω
κάποιου deadline.

Χάρη σε αυτή τη διαδικασία, μπορείτε πάντα να δοκιμάσετε το επόμενο χτίσιμο της
Rust και να βεβαιωθείτε ότι η αναβάθμιση θα είναι εύκολη: αν η δοκιμαστική
κυκλοφορία δε λειτουργεί όπως περιμένετε, μπορείτε να το αναφέρετε στην ομάδα
και θα κοιτάξουν να το φτιάξουν πριν την επόμενη σταθερή κυκλοφορία. Το να χαλάσει
κάτι σε κάποια δοκιμαστική κυκλοφορία είναι σχετικά σπάνιο, αλλά ο `rustc` είναι
απλά άλλο ένα λογισμικό, και λάθη συμβαίνουν.

### Ασταθείς Δυνατότητες

Υπάρχει ένα ακόμα θέμα με αυτό το μοντέλο κυκλοφορίας: οι ασταθείς δυνατότητες. Η Rust χρησιμοποιεί μια τεχνική που λέγεται «σημαίες
δυνατοτήτων» για να αποφασίσει ποιες δυνατότητες είναι διαθέσιμες σε κάθε
δοθείσα κυκλοφορία. Αν μια δυνατότητα είναι ακόμα υπό ενεργή ανάπτυξη,
καταλήγει στο `master`, και άρα στο νυχτερινό κανάλι, αλλά πίσω από μια *σημαία δυνατότητας*. Αν εσείς, ως χρήστης, θέλετε να δοκιμάσετε μία
δυνατότητα η οποία είναι υπό κατασκευή, μπορείτε, αλλά πρέπει να
χρησιμοποιείτε μια νυχτερινή εκδοχή της Rust και να υποσημειώσετε τον
κώδικά σας με την κατάλληλη σημαία για να συμμετάσχετε.

Αν χρησιμοποιείτε τη δοκιμασιτκή ή τη σταθερή κυκλοφορία της Rust, δε
μπορείτε να χρησιμοποιήσετε σημαίες δυνατοτήτων. Αυτό είναι το κλειδί που
μας επιτρέπει να πάρουμε μια γεύση πρακτικής χρήσης μιας νέας δυνατότητας
πριν την ανακηρύξουμε σταθερή για πάντα. Όσοι θέλουν να συμμετάσχουν στην
«κόψη του ξυραφιού» μπορούν να το κάνουν, και όσοι θέλουν μια σταθερή
εμπειρία μπορούν να μείνουν στο σταθερό κανάλι και να ξέρουν ότι ο κώδικάς
τους δε θα χαλάσει. Σταθερότητα χωρίς στασιμότητα.

Αυτό το βιβλίο περιέχει πληροφορίες μόνο για τις σταθερές δυνατότητες,
καθώς οι υπό ανάπτυξη δυνατότητας αλλάζουν ακόμα και σίγουρα θα έχουν αλλάξει
διαφορετικές από τη στιγμή της συγγραφής αυτού του βιβλίου ως τη στιγμή της
σταθερής τους κυκλοφορίας. Μπορείτε να βρείτε τεκμηρίωση των νυχτερινών
δυνατοτήτων στο διαδίκτυο.

### Το Rustup και ο Ρόλος της Νυχτερινής Rust

Το rustup διεκολύνει την εναλλαγή μεταξύ των καναλιών κυκλοφορίας, είτε καθολικά είτε ανά project. Εκ προεπιλογής, θα έχετε εγκατεστημένη τη σταθερή Rust. Για να εγκαταστήσετε τη νυχτερινή, για παράδειγμα:

```text
$ rustup install nightly
```

Με το `rustup` μπορείτε επίσης να δείτε όλες τις *εργαλειοθήκες* (κυκλοφορίες της Rust και σχετικά εξαρτήματα) τις οποίες εγκατεστημένες. Ορίστε ένα παράδειγμα του υπολογιστή των συγγραφέων, σε λειτουργικό Windows:

```powershell
> rustup toolchain list
stable-x86_64-pc-windows-msvc (default)
beta-x86_64-pc-windows-msvc
nightly-x86_64-pc-windows-msvc
```

Όπως μπορείτε να δείτε, η σταθερή εργαλειοθήκη είναι η προεπιλεγμένη. Οι
περισσότεροι χρήστες της Rust χρησιμοποιούν τη σταθερή τον περισσότερο καιρό.
Μπορεί να θελήσετε να χρησιμοσποιήσετε τη σταθερή τον περισσότερο καιρό, αλλά
για ένα συγκεκριμένο project να θέλετε να χρησιμοποιήσετε τη νυχτερινή, επειδή
ενδιαφέρεστε για κάποια πολύ καινούρια δυνατότητα. Για να το κάνετε αυτό,
μπορείτε να χρησιμοποιήσετε το `rustup override` στο φάκελο αυτού του project
ώστε να θέσετε τη νυχτερινή εργαλειοθήκη ως αυτήν που θα επιλέγει το `rustup`
όταν είστε σ' εκείνο το φάκελο.

As you can see, the stable toolchain is the default. Most Rust users use stable
most of the time. You might want to use stable most of the time, but use
nightly on a specific project, because you care about a cutting-edge feature.
To do so, you can use `rustup override` in that project’s directory to set the
nightly toolchain as the one `rustup` should use when you’re in that directory:

```text
$ cd ~/projects/needs-nightly
$ rustup override set nightly
```
Τώρα, κάθε φορά που καλείτε το `rustc` ή το `cargo` μέσα στο *~/projects/needs-nightly*,
το `rustup` θα σιγουρευτεί ότι χρησιμοποιείτε τη νυχτερινή Rust, αντί την
προεπιλεγμένη σας σταθερή Rust. Αυτό είναι αρκετά χρήσιμο όταν έχετε πολλά
projects σε Rust!

### Η Διαδικασία RFC και οι Ομάδες

Λοιπόν, πώς μαθαίνει κανείς για αυτές τις νέες δυνατότητες; Το μοντέλο
ανάπτυξης της Rust ακολουθεί μια διαδικασία *RFC, ή αλλιώς «Request For Comments»*, δηλαδή *«Αίτημα για Σχολια»*. Αν θέλετε να δείτε κάποια βελτίωση
στη Rust, μπορείτε να γράψετε μία πρόταση, η οποία λέγεται RFC.

Οποιοσδήποτε μπορεί να γράψει ένα RFC για να βελτιώσει τη Rust, και οι
προτάσεις αξιολογούνται και συζητιούνται από την ομάδα της Rust, η οποία
διαρθρώνεται από πολλές διαφορετικές υπο-ομάδες ανά θέμα. Υπάρχει μια πλήρης
λίστα των ομάδων [στον ιστότοπο της Rust](https://www.rust-lang.org/en-US/team.html), η οποία περιλαμβάνει ομάδες για
κάθε περιοχή του project: σχεδιασμός της γλώσσας, υλοποίηση του μεταγλωττιστή,
υποδομές, τεκμηρίωση, και άλλα. Η κατάλληλη ομάδα διαβάζει την πρότασή σας
και τα σχόλια, γράφει μερικά σχόλια και η ίδια, και κάποια στιγμή καταλήγει
σε μια απόφαση για το αν η προτεινόμενη δυνατόητα εγκρίνεται ή απορρίπτεται.

Αν η δυνατότητα εγκριθεί, ανοίγεται ένα νήμα στο αποθετήριο της Rust, και μπορεί κανείς να το υλοποιήσει. Το άτομο που το υλοποιεί μπορεί κάλλιστα να
μην είναι το άτομο που έκανε την αρχική πρόταση! Όταν η υλοποίηση είναι
έτοιμη, καταλήγει στον κλάδο `master` πίσω από μία πύλη δυνατοτήτων, όπως
αναφέραμε στην ενότητα «Ασταθείς Δυνατότητες».

Μετά από κάποιο διάστημα, όταν οι χρήστες που χρησιμοποιούν τις νυχτερινές
κυκλοφορίες έχουν δοκιμάσει τη νέα δυνατότητα, τα μέλη της ομάδας θα τη
συζητήσουν, θα κοιτάξουν πώς πήγε στη νυχτερινή κυκλοφορία, και θα αποφασίσουν
αν θα συμπεριληφθεί στη σταθερή Rust ή όχι. Αν η απόφαση είναι να προχωρήσει,
η πύλη δυνατοτήτων αφαιρείται, και η δυνατότητα πλέον θεωρείται σταθερή! Έτσι,
παίρνει τα τρένα για να καταλήξει σε μια μελλοντική σταθερή κυκλοφορία της Rust.